name: Check Links

on:
  # Run on pull requests
  pull_request:
    branches:
      - main
  # Run on schedule every week
  schedule:
    - cron: '0 18 * * 0' # 6pm every Sunday
  # Allow manual trigger
  workflow_dispatch:

jobs:
  linkChecker:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      issues: write # required to create issues
    steps:
    - name: Checkout
      uses: actions/checkout@d632683dd7b4114ad314bca15554477dd762a938 # v4.2.0

    - name: Link Checker
      id: lychee
      uses: lycheeverse/lychee-action@v2
      with:
        fail: true
        format: markdown
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

    - name: Create Issue From File
      if: env.exit_code != 0
      uses: peter-evans/create-issue-from-file@v5
      with:
        title: 'ðŸ”— Broken links detected'
        content-filepath: ./lychee/out.md
        labels: broken-link, automated issue